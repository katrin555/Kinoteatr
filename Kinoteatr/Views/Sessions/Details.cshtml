@model Session
@{
    ViewData["Title"] = "Выбор мест";
    var bookedSeatIds = ViewBag.BookedSeatIds as List<int> ?? new List<int>();
}

<h1>@Model.Movie.Title</h1>
<p>@Model.DateTime.ToString("dd.MM.yyyy HH:mm") - Зал: @Model.Hall.Name</p>
<p>Цена: @Model.Price руб.</p>

<h2>Выберите место</h2>

<div>
    @{
        var seatsByRow = Model.Hall.Seats.GroupBy(s => s.Row).OrderBy(g => g.Key);
    }
    @foreach (var rowGroup in seatsByRow)
    {
        <div>
            <strong>Ряд @rowGroup.Key:</strong>
            @foreach (var seat in rowGroup.OrderBy(s => s.SeatNumber))
            {
                var isBooked = bookedSeatIds.Contains(seat.Id);
                if (isBooked)
                {
                    <span style="background-color: red; color: white; padding: 5px; margin: 2px;">@seat.SeatNumber</span>
                }
                else
                {
                    <form asp-controller="Tickets" asp-action="Reserve" method="post" style="display:inline;">
                        <input type="hidden" name="sessionId" value="@Model.Id" />
                        <input type="hidden" name="seatId" value="@seat.Id" />
                        <button type="submit" style="background-color: green; color: white; padding: 5px; margin: 2px;">@seat.SeatNumber</button>
                    </form>
                }
            }
        </div>
    }
</div>

<p>Зеленые - свободные, красные - занятые</p>

